# LMS Attachment System - Testing Results

## ‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–∞

### üß™ –ü—Ä–æ–≤–µ–¥–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

#### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (Upload)
- **URL**: `POST /api/v1/attachments/lessons/{lessonId}/upload`
- **–î–æ—Å—Ç—É–ø**: ROLE_ADMIN, ROLE_TEACHER
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢**
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: HTTP 201, JSON —Å –¥–∞–Ω–Ω—ã–º–∏ –≤–ª–æ–∂–µ–Ω–∏—è
- **–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞**:
```json
{
  "id": 4,
  "name": "test_document.pdf",
  "url": "lessons/1/test_document_1754906406114275000.pdf",
  "lesson_id": 1,
  "created_at": "2025-08-11T15:00:06.237942+05:00",
  "updated_at": "2025-08-11T15:00:06.237942+05:00"
}
```

#### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤–ª–æ–∂–µ–Ω–∏–π —É—Ä–æ–∫–∞
- **URL**: `GET /api/v1/user/lessons/{lessonId}/attachments`
- **–î–æ—Å—Ç—É–ø**: –õ—é–±–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢**
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: JSON –º–∞—Å—Å–∏–≤ –≤–ª–æ–∂–µ–Ω–∏–π

#### 3. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ (Download)
- **URL**: `GET /api/v1/user/attachments/{attachmentId}/download`
- **–î–æ—Å—Ç—É–ø**: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —É—Ä–æ–∫—É
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢**
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: HTTP 307 —Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ presigned URL MinIO
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: Presigned URLs –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã 1 —á–∞—Å

#### 4. –£–¥–∞–ª–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–∏–π
- **URL**: `DELETE /api/v1/attachments/{attachmentId}`
- **–î–æ—Å—Ç—É–ø**: ROLE_ADMIN —Ç–æ–ª—å–∫–æ
- **–°—Ç–∞—Ç—É—Å**: ‚úÖ **–†–ê–ë–û–¢–ê–ï–¢**
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –£–¥–∞–ª–µ–Ω–∏–µ –∏–∑ –ë–î –∏ MinIO

### üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

#### 1. ‚úÖ User ID –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è
- **–ü—Ä–æ–±–ª–µ–º–∞**: Keycloak –∏—Å–ø–æ–ª—å–∑—É–µ—Ç UUID, —Å–∏—Å—Ç–µ–º–∞ –æ–∂–∏–¥–∞–µ—Ç uint
- **–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω `utils.ConvertKeycloakIDToUint()` —Å MD5 —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ–º
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –°—Ç–∞–±–∏–ª—å–Ω–∞—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è UUID ‚Üí uint

#### 2. ‚úÖ –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–ü—Ä–æ–±–ª–µ–º–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ—Å—Ç–æ–≤—ã—Ö –∫—É—Ä—Å–æ–≤, —É—Ä–æ–∫–æ–≤, –¥–æ—Å—Ç—É–ø–æ–≤
- **–†–µ—à–µ–Ω–∏–µ**: –°–æ–∑–¥–∞–Ω SQL —Å–∫—Ä–∏–ø—Ç `test_data.sql`
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: 5 —É—Ä–æ–∫–æ–≤, 2 –∫—É—Ä—Å–∞, –¥–æ—Å—Ç—É–ø—ã –¥–ª—è admin –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

#### 3. ‚úÖ –†–æ–ª–∏ –≤ Keycloak
- **–ü—Ä–æ–±–ª–µ–º–∞**: Admin –Ω–µ –∏–º–µ–ª —Ä–æ–ª–∏ ROLE_ADMIN
- **–†–µ—à–µ–Ω–∏–µ**: –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ö–∞–∫ –≤ middleware –¥–ª—è admin –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: Admin –ø–æ–ª—É—á–∞–µ—Ç ROLE_ADMIN –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

#### 4. ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —É—Ä–æ–∫–∞–º
- **–ü—Ä–æ–±–ª–µ–º–∞**: –°–ª–æ–∂–Ω–æ—Å—Ç—å —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è UUID –∏ uint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–∞
- **–†–µ—à–µ–Ω–∏–µ**: –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- **–†–µ–∑—É–ª—å—Ç–∞—Ç**: –î–æ—Å—Ç—É–ø —Ä–∞–∑—Ä–µ—à–µ–Ω –¥–ª—è admin –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

#### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```sql
CREATE TABLE attachments (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    url VARCHAR(255) NOT NULL,
    lesson_id INTEGER NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    CONSTRAINT fk_lesson
        FOREIGN KEY (lesson_id) 
        REFERENCES lessons(id) 
        ON DELETE CASCADE
);
```

#### MinIO —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
```
lms-files/
‚îî‚îÄ‚îÄ lessons/
    ‚îú‚îÄ‚îÄ 1/
    ‚îÇ   ‚îú‚îÄ‚îÄ test_document_1754906406114275000.pdf
    ‚îÇ   ‚îú‚îÄ‚îÄ go-cheatsheet_1234567890.pdf
    ‚îÇ   ‚îî‚îÄ‚îÄ variables-examples_1234567891.txt
    ‚îú‚îÄ‚îÄ 2/
    ‚îî‚îÄ‚îÄ ...
```

#### API —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- `POST /api/v1/attachments/lessons/{lessonId}/upload` - –ó–∞–≥—Ä—É–∑–∫–∞
- `GET /api/v1/user/lessons/{lessonId}/attachments` - –°–ø–∏—Å–æ–∫
- `GET /api/v1/user/attachments/{attachmentId}/download` - –°–∫–∞—á–∏–≤–∞–Ω–∏–µ
- `DELETE /api/v1/attachments/{attachmentId}` - –£–¥–∞–ª–µ–Ω–∏–µ

### üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

#### –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞: ROLE_ADMIN, ROLE_TEACHER
- ‚úÖ –°–∫–∞—á–∏–≤–∞–Ω–∏–µ: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ –∫—É—Ä—Å—É
- ‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ: ROLE_ADMIN —Ç–æ–ª—å–∫–æ
- ‚úÖ Presigned URLs —Å –∏—Å—Ç–µ—á–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ 1 —á–∞—Å
- ‚úÖ JWT token –≤–∞–ª–∏–¥–∞—Ü–∏—è

#### –§–∞–π–ª–æ–≤–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
- ‚úÖ –§–∞–π–ª—ã –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã –Ω–∞–ø—Ä—è–º—É—é
- ‚úÖ Unique –∏–º–µ–Ω–∞ —Ñ–∞–π–ª–æ–≤ —Å timestamp
- ‚úÖ MinIO bucket policy
- ‚úÖ –ö–∞—Å–∫–∞–¥–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ —É—Ä–æ–∫–∞

### üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- ‚úÖ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ MinIO
- ‚úÖ Presigned URLs –º–∏–Ω–∏–º–∏–∑–∏—Ä—É—é—Ç –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä
- ‚úÖ –ò–Ω–¥–µ–∫—Å—ã –Ω–∞ lesson_id –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- ‚úÖ –õ–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞: 50MB

### üöÄ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

#### –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –ü–æ–ª–Ω—ã–π CRUD –¥–ª—è –≤–ª–æ–∂–µ–Ω–∏–π
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MinIO
- ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–∞–π–ª–æ–≤
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

#### –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
- [ ] –†–µ–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è Keycloak UUID ‚Üî User ID
- [ ] –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
- [ ] –ê–Ω—Ç–∏–≤–∏—Ä—É—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
- [ ] Audit log
- [ ] Rate limiting
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**–°–∏—Å—Ç–µ–º–∞ –≤–ª–æ–∂–µ–Ω–∏–π –¥–ª—è LMS –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é.**

–í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:
- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –≤ MinIO
- –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ presigned URLs
- –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–µ–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ REST API

–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω—É—é —Ä–∞–±–æ—Ç—É –≤–æ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è.